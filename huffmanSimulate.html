<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Huffman Code Simulation</title>
		<style>
			canvas{
				border: solid 1px green;
			}
		</style>
	</head>

	<body>
		<form name = "HuffmanForm" id="HuffmanForm" >
			<table>
				<tr>
					<td>
						<table>
							<tr>
								<td><p id = "prompt">請先輸入各字元頻率後按下確認，或點選系統自動產生頻率</p></td>
							</tr>		
						</table>
						<hr>
						<table>
							<tr>
								<td><input type = "button"  value = "系統產生頻率" onClick = "systemGenerateFrequency();" id = "generateFrequency" ></td> 
								<td><input type = "button"  value = "自行輸入頻率(確認)" onClick = "selfInputFrequency();" id = "inputFrequency" ></td>
								<td><input type = "button"  value = "全部清除" onClick = "clearFrequency();" id = "clearFreq" ></td> 	
							</tr>
						</table>
						<table border="2">
							<tr>
								<td align="center"><p>字元</p></td>
								<td align="center">A</td>
								<td align="center">B</td>
								<td align="center">C</td>
								<td align="center">D</td>
								<td align="center">E</td>
							</tr>
							<tr>
								<td align="center"><p>頻率</p></td>
								<td><input type=text value="" id = frequency0 size="7"></td>
								<td><input type=text value="" id = frequency1 size="7"></td>
								<td><input type=text value="" id = frequency2 size="7"></td>
								<td><input type=text value="" id = frequency3 size="7"></td>
								<td><input type=text value="" id = frequency4 size="7"></td>	
							</tr>
						</table>
						<p id = "inputCheck"></p>
						<hr>
						<table>
							<tr>
								<td>
									<input type = "button"  value = "逐步執行" onClick = "stepExecute();" id = "stepExe">
								</td>
								
							</tr>
							<tr>
								<td>
									<input type = "button"  value = "一次做完" onClick = "allExecute();" id = "allExe">
								</td>
								<td>
									<p>速度--></p>
								</td>
								<td>
									<input type="radio" name="speed" value="慢" onClick = "speedChoice();">慢
								</td>
								<td>
									<input type="radio" name="speed" value="中" onClick = "speedChoice();">中
								</td>
								<td>
									<input type="radio" name="speed" value="快" onClick = "speedChoice();">快
								</td>
							</tr>
						</table>
						<table>
							<tr>	
								<td>
									<p id = "current">目前進度:</p>
								</td>
							</tr>
							<tr>	
								<td>
									<textarea name="Content" style="width:500px;height:150px;" id=huffmanCurrent readonly="readonly"></textarea>
								</td>
							</tr>
							<tr>	
								<td>
									<p id = "all">所有過程:</p>
								</td>
							</tr>
							<tr>	
								<td>
									<textarea name="Content" style="width:500px;height:150px;" id=huffmanAll readonly="readonly"></textarea>
								</td>
							</tr>

						</table>																
					</td>
						
					<td>
						<table>
							<tr>
								<td>
									<p>Huffman tree:</p>
								</td>
							</tr>
							<tr>
								<td>
									<canvas id = "huffmanGraph" width = 830 height = 450>Your browser does not support</canvas>
								</td>
							</tr>
							<tr>
								<td>
									<p>編碼結果:</p>
								</td>
							</tr>
							<tr>
								<table border="2">
									<tr>
										<td align="center"><p>字元</p></td>
										<td align="center">A</td>
										<td align="center">B</td>
										<td align="center">C</td>
										<td align="center">D</td>
										<td align="center">E</td>
									</tr>
									<tr>
										<td align="center"><p>code</p></td>
										<td><input type=text value="" id = code1 size="7" readonly="readonly"></td>
										<td><input type=text value="" id = code2 size="7" readonly="readonly"></td>
										<td><input type=text value="" id = code3 size="7" readonly="readonly"></td>
										<td><input type=text value="" id = code4 size="7" readonly="readonly"></td>
										<td><input type=text value="" id = code5 size="7" readonly="readonly"></td>
									</tr>
								</table>
							</tr>
						</table>		
					</td>
				</tr>
			</table>
		</form>

		<script>
			var character = new Array("A","B","C","D","E");
			var characterFrequency = new Array(0,0,0,0,0); // record the character frequency
			var compareFrequencyArray = new Array("0","0","0","0","0"); // handle the combine frequency
			var characterCode = new Array("0","0","0","0","0"); // record the character huffman code
			var graphArray = new Array(); // Use to draw the whole huffman tree. 
			

			// Record the circle's X and Y
			var circleX = new Array(0,415,215,615,115,315,515,715,65,165,
									265,365,465,565,665,765,40,90,140,190,
									240,290,340,390,440,490,540,590,640,690,
									740,790);
			var circleY = new Array(0,120,190,190,260,260,260,260,330,330,
									330,330,330,330,330,330,400,400,400,400,
									400,400,400,400,400,400,400,400,400,400,
									400,400);

			var ifInputFrequency = 0; // 0 is not input frequency, 1 is input frequency.
			var isDecideSpeed = 0;

			var huffmanStep = 0;
			var lowSpeed = 10;
			var medSpeed = 5;
			var highSpeed = 1;
			var singalNodeNumber = new Array(16,18,20,22,24);
			var singalNodeTime = 0;
			var doubleNodeNumber = new Array(12,14);
			var doubleNodeTime = 0;
			var thripleNodeNumber = new Array(7);
			var thripleNodeTime = 0;
			var forthNodeNumber = new Array(3);
			var forthNodeTime = 0;

			// The function will be invoke, when you open the HTML file
			window.onload = function (){
				clearAll();
				for(i = 0; i < 33; i++){
　					graphArray[i] = "2";　// 開始建立陣列
				}
			}

			function systemGenerateFrequency(){
				clearAll();

				var temp = "frequency";
				var randomNumber = 0;
				for(var count = 0; count < characterFrequency.length; count++){
					randomNumber = 1 + Math.floor(Math.random()*50);
					characterFrequency[count] = randomNumber;
					temp = temp + count;
					document.getElementById(temp).value = randomNumber;
					temp = "frequency";
				}
				ifInputFrequency = 1;
				document.getElementById("prompt").innerHTML = "請點選逐步執行或是可以先選擇速度再按下一次做完觀看過程";
				
			}

			function clearFrequency(){
				ifInputFrequency = 0;
				var temp = "frequency";
				for(var count = 0; count < characterFrequency.length; count++){
					characterFrequency[count] = 0;
					temp = temp + count;
					document.getElementById(temp).value = 0;
					temp = "frequency";
				}
				document.getElementById("prompt").innerHTML = "請先輸入各字元頻率後按下確認，或點選系統自動產生頻率";
				clearGraph();
			}

			function drawWholeGraph(){
				
				var canvas = document.getElementById("huffmanGraph"); // Catch the canvas
				var ctx = canvas.getContext("2d"); // Draw all object in two dimension

				ctx.font = "14px Verdana"; // Set the word size = 14px typeface = Verdana

				/*
				ctx.beginPath();
				ctx.arc(circleX[1],circleY[1],20,0,2 * 3.14); // the 0 circle
				ctx.stroke();

				var characterStringHandle = graphArray[1].split("-");
				ctx.fillText(characterStringHandle[0],circleX[1],circleY[1]); // write the number.

				*/
				//graphArray[7] = "0";

				for(var i = 31; i > 0; i--){
					var characterStringHandle = graphArray[i].split("-");
					if(graphArray[i] != "0"){ // judge the circle need to draw or not.
						ctx.beginPath();
						ctx.arc(circleX[i],circleY[i],20,0,2 * 3.14); // the 0 circle
						ctx.stroke();

						/** To line with upper circle, so need to decide the upper number */
						var father = Math.floor(i / 2); // Use the concept(heap)
						if(graphArray[father] != "0"){
							ctx.beginPath();
							ctx.moveTo(circleX[father],circleY[father] + 20);
							ctx.lineTo(circleX[i],circleY[i] - 20);
							ctx.stroke();
						}

						/** To write the 0 or 1, need to judge the current is even or not */
						if(i % 2 == 0){
							if(graphArray[father] != "0"){
								var numberX = (circleX[i] + circleX[father]) / 2 - 10;
								var numberY = (circleY[i] + circleY[father]) / 2 - 10;
								ctx.fillText("0",numberX,numberY); // write the number.
							}
						}else{
							if(graphArray[father] != "0"){
								var numberX = (circleX[i] + circleX[father]) / 2 + 10;
								var numberY = (circleY[i] + circleY[father]) / 2 - 10;
								ctx.fillText("1",numberX,numberY); // write the number.
							}
						}

						
						if(characterStringHandle.length == 1){ // only write number
							ctx.fillText(characterStringHandle[0],circleX[i],circleY[i]); // write the number.
						}else{
							ctx.fillText(characterStringHandle[0],circleX[i],circleY[i] - 5); // write the number.

							ctx.beginPath();
							ctx.moveTo(circleX[i] + 20, circleY[i]);
							ctx.lineTo(circleX[i] - 20, circleY[i]);
							ctx.stroke();

							ctx.fillText(characterStringHandle[1],circleX[i] - 4,circleY[i] + 13); // write the number.
						}
					}/*else{
						var children1 = i * 2;
						var children2 = i * 2 + 1;
						if(children1 < 32 && children2 < 32){
							if(graphArray[children1] != "0" && graphArray[children2] != "0"){
								var children1Handle = graphArray[children1].split("-");
								var children2Handle = graphArray[children2].split("-");
								var addNumber = parseInt(children1Handle[1]) + parseInt(children2Handle[1]);
								ctx.fillText(addNumber,circleX[i],circleY[i]); // write the number.
							}
						}
					}*/
				}// end for loop
			}// end function drawWholeGraph()

			function stepExecute(){
				drawWholeGraph();
				clearGraphData();
				clearGraph();
				/*
				if(huffmanStep == 0){ // init
					for(var j = 0; j < characterFrequency.length; j++){
						compareFrequencyArray[j] = character[j] + "-" + characterFrequency[j];
						fillGraphData(compareFrequencyArray[j]);
					}
					drawWholeGraph();
				}else if(huffmanStep == 1){

				}else{

				}*/
				characterCode[0] = "0";
				characterCode[2] = "1";
				fillGraphData("147-A-C");
				drawWholeGraph();
			}

			function fillGraphData(demand){
				var judgeArray = demand.split("-");
				if(judgeArray.length == 2 && singalNodeTime != 5){ // singal node
					graphArray[singalNodeNumber[singalNodeTime]] = demand;
					singalNodeTime = singalNodeTime + 1;
				}else if(judgeArray.length == 3 && doubleNodeTime != 2){
					var start = doubleNodeNumber[doubleNodeTime];
					if(doubleNodeTime == 0){
						var n1 = characterFrequency[giveCharacterLocate(judgeArray[1])];
						var n2 = characterFrequency[giveCharacterLocate(judgeArray[2])];
						var sum = n1 + n2;
						graphArray[start] = sum.toString();
						for(var count = 1; count < judgeArray.length; count++){
							var locate = giveCharacterLocate(judgeArray[count]);
							if(characterCode[locate] == "0"){
								graphArray[start * 2] = character[locate] + "-" + characterFrequency[locate];
							}else if(characterCode[locate] == "1"){
								graphArray[start * 2 + 1] = character[locate] + "-" + characterFrequency[locate];
							}else{

							}
						}
					}else if(doubleNodeTime == 1){
						var n1 = characterFrequency[giveCharacterLocate(judgeArray[1])];
						var n2 = characterFrequency[giveCharacterLocate(judgeArray[2])];
						var sum = n1 + n2;
						graphArray[start] = sum.toString();
						for(var count = 1; count < judgeArray.length; count++){
							var locate = giveCharacterLocate(judgeArray[count]);
							if(characterCode[locate] == "0"){
								graphArray[start * 2] = character[locate] + "-" + characterFrequency[locate];
							}else if(characterCode[locate] == "1"){
								graphArray[start * 2 + 1] = character[locate] + "-" + characterFrequency[locate];
							}else{

							}
						}
					}
					doubleNodeTime = doubleNodeTime + 1;
				}else{

				}
			}

			function giveCharacterLocate(char){
				var location = 7; 
				if(char == character[0]){
					location = 0;
				}else if(char == character[1]){
					location = 1;
				}else if(char == character[2]){
					location = 2;
				}else if(char == character[3]){
					location = 3;
				}else if(char == character[4]){
					location = 4;
				}
				return location;
			}

			function clearGraph(){
				var canvas = document.getElementById("huffmanGraph"); // Get the canvas by its id.
				var ctx = canvas.getContext("2d"); // set the canvas in the environment 2D.
				ctx.clearRect(0,0,canvas.width,canvas.height); // By drawing a white rectangle, we can clear the graph on canvas. 
			}// end function clearGraph()



			function clearAll(){
				clearFrequency();
				for(var count = 0; count < characterFrequency.length; count++){
					compareFrequencyArray[count] = "";
					characterCode[count] = "";
					
				}

				for(var count = 0; count < graphArray.length; count++){
					graphArray[count] = "0";
				}

				ifInputFrequency = 0;
				isDecideSpeed = 0;
				huffmanStep = 0;
				singalNodeTime = 0;
				doubleNodeTime = 0;	
				thripleNodeTime = 0;
				forthNodeTime = 0;
				clearGraph();
			}// end function clearAll()

			function clearGraphData(){
				for(var count = 0; count < graphArray.length; count++){
					graphArray[count] = "0";
				}
			}

		</script>
	</body>
</html>
